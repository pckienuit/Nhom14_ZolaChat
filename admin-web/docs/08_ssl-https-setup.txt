# SSL/HTTPS Setup Guide - ZolaChat Admin Web

## Th√¥ng tin h·ªá th·ªëng

**Domain:** zolachat.site
**VPS IP:** 163.61.182.20
**SSL Provider:** Let's Encrypt (Certbot)
**Web Server:** Apache2 (Ubuntu/Debian)
**Certificate Expiry:** 2026-03-24 (Auto-renewal enabled)

---

## 1. ƒêƒÉng k√Ω v√† C·∫•u h√¨nh Domain

### 1.1. Th√¥ng tin Domain
- **Registrar:** Tenten.vn
- **Ng√†y ƒëƒÉng k√Ω:** 2025-12-23 23:36:38
- **Ng√†y h·∫øt h·∫°n:** 2026-12-23 00:00:00
- **Nameservers:** 
  - ns-a1.tenten.vn
  - ns-a2.tenten.vn
  - ns-a3.tenten.vn

### 1.2. DNS Records Configuration
ƒêƒÉng nh·∫≠p v√†o Tenten.vn v√† c·∫•u h√¨nh DNS records:

| Host | Type | Value | TTL |
|------|------|-------|-----|
| @ | A | 163.61.182.20 | 0 (Auto) |
| www | A | 163.61.182.20 | 0 (Auto) |

**L∆∞u √Ω:** Sau khi c·∫•u h√¨nh, DNS c·∫ßn 5-30 ph√∫t ƒë·ªÉ lan truy·ªÅn (propagation).

### 1.3. Ki·ªÉm tra DNS ho·∫°t ƒë·ªông
```bash
# Tr√™n m√°y local (Windows)
ping zolachat.site

# Ho·∫∑c d√πng nslookup
nslookup zolachat.site

# Ho·∫∑c ki·ªÉm tra online
https://www.whatsmydns.net/#A/zolachat.site
```

---

## 2. C√†i ƒë·∫∑t SSL Certificate v·ªõi Let's Encrypt

### 2.1. Script t·ª± ƒë·ªông `setup_ssl.sh`
File script ƒë√£ ƒë∆∞·ª£c t·∫°o s·∫µn t·∫°i: `scripts/setup_ssl.sh`

**N·ªôi dung script:**
- C√†i ƒë·∫∑t Certbot v√† Apache modules
- T·∫°o VirtualHost configuration
- Request SSL certificate t·ª´ Let's Encrypt
- Enable auto-renewal cho certificate
- Redirect HTTP ‚Üí HTTPS t·ª± ƒë·ªông

### 2.2. C√°ch s·ª≠ d·ª•ng
```bash
# 1. Upload script l√™n VPS
scp d:\DoAn_ZaloClone\scripts\setup_ssl.sh root@163.61.182.20:/root/

# 2. SSH v√†o VPS
ssh root@163.61.182.20

# 3. C·∫•p quy·ªÅn v√† ch·∫°y
chmod +x setup_ssl.sh
./setup_ssl.sh
```

### 2.3. K·∫øt qu·∫£ mong ƒë·ª£i
```
SUCCESS! SSL Certificate installed successfully.
Your website is now secure at: https://zolachat.site
Admin Panel: https://zolachat.site/admin/dashboard.html
```

### 2.4. C·∫•u h√¨nh Apache ƒë∆∞·ª£c t·∫°o
**File:** `/etc/apache2/sites-available/zolachat.site.conf`
- HTTP VirtualHost (Port 80) - T·ª± ƒë·ªông redirect to HTTPS
- DocumentRoot: `/var/www/admin`
- API Proxy: `/api` ‚Üí `http://localhost:3000/api`

**File SSL:** `/etc/apache2/sites-available/zolachat.site-le-ssl.conf`
- HTTPS VirtualHost (Port 443)
- Certificate paths ƒë∆∞·ª£c Certbot t·ª± ƒë·ªông c·∫•u h√¨nh
- SSL Protocol: TLSv1.2, TLSv1.3

### 2.5. Certificate Files
```
/etc/letsencrypt/live/zolachat.site/
‚îú‚îÄ‚îÄ fullchain.pem (Certificate chain)
‚îú‚îÄ‚îÄ privkey.pem (Private key)
‚îú‚îÄ‚îÄ cert.pem (Domain certificate)
‚îî‚îÄ‚îÄ chain.pem (Intermediate certificates)
```

---

## 3. C·∫≠p nh·∫≠t Code cho Domain M·ªõi

### 3.1. Files ƒë√£ ƒë∆∞·ª£c update

#### Admin Web - JavaScript
**File:** `admin-web/js/stickers.js` (Line 217)
```javascript
// OLD:
const response = await fetch('http://163.61.182.20/api/stickers/upload', {

// NEW:
const response = await fetch('https://zolachat.site/api/stickers/upload', {
```

#### Python Scripts
**File:** `scripts/bulk_import_stickers.py` (Line 45-46)
```python
# OLD:
VPS_UPLOAD_URL = "http://163.61.182.20/api/stickers/upload"
VPS_BASE_URL = "http://163.61.182.20/stickers"

# NEW:
VPS_UPLOAD_URL = "https://zolachat.site/api/stickers/upload"
VPS_BASE_URL = "https://zolachat.site/stickers"
```

**File:** `scripts/admin_upload_sticker_pack.py` (Line 34-35)
```python
# Same changes as bulk_import_stickers.py
```

#### Deployment Script
**File:** `scripts/deploy_admin_web.sh` (Line 88)
```bash
# OLD:
echo "  üìç http://163.61.182.20/admin/"

# NEW:
echo "  üìç https://zolachat.site/admin/"
```

### 3.2. Files KH√îNG c·∫ßn update
- **SSH/SCP connections:** V·∫´n d√πng IP `163.61.182.20` v√¨ ·ªïn ƒë·ªãnh h∆°n domain
- **Firebase config:** Kh√¥ng li√™n quan ƒë·∫øn VPS domain
- **Android App:** Kh√¥ng hardcoded VPS URL (ch·ªâ load ·∫£nh t·ª´ Firestore)

---

## 4. Deploy Admin Web v·ªõi Domain M·ªõi

### 4.1. Deploy b·∫±ng SCP (Khuy√™n d√πng)
```bash
# Upload to√†n b·ªô Admin Web
scp -r d:\DoAn_ZaloClone\admin-web\* root@163.61.182.20:/var/www/admin/

# Ho·∫∑c ch·ªâ upload file stickers.js ƒë√£ s·ª≠a
scp d:\DoAn_ZaloClone\admin-web\js\stickers.js root@163.61.182.20:/var/www/admin/js/
```

### 4.2. Deploy b·∫±ng Script
```bash
cd d:\DoAn_ZaloClone
bash scripts/deploy_admin_web.sh
```

### 4.3. Set permissions tr√™n VPS
```bash
ssh root@163.61.182.20

# C·∫•p quy·ªÅn cho Apache
chown -R www-data:www-data /var/www/admin
chmod -R 755 /var/www/admin

# Reload Apache
systemctl reload apache2
```

---

## 5. Testing & Verification

### 5.1. Ki·ªÉm tra HTTPS ho·∫°t ƒë·ªông
```bash
# Test t·ª´ command line
curl -I https://zolachat.site/admin/

# Ki·ªÉm tra certificate
openssl s_client -connect zolachat.site:443 -servername zolachat.site
```

### 5.2. Ki·ªÉm tra tr√™n Browser
1. M·ªü: `https://zolachat.site/admin/dashboard.html`
2. X√°c nh·∫≠n c√≥ ·ªï kh√≥a xanh (üîí) trong address bar
3. Click v√†o ·ªï kh√≥a ‚Üí Certificate valid
4. Kh√¥ng c√≥ warning "Not Secure"

### 5.3. Test Upload Sticker
1. Login v√†o Admin Panel: `https://zolachat.site/admin/dashboard.html`
2. Navigate to Sticker Packs
3. Edit m·ªôt pack ‚Üí Upload sticker m·ªõi
4. Ki·ªÉm tra URL c·ªßa sticker c√≥ d·∫°ng: `https://zolachat.site/stickers/...`

### 5.4. Test Mixed Content
M·ªü Developer Console (F12) v√† ki·ªÉm tra:
- ‚ùå Kh√¥ng c√≥ warning: "Mixed Content"
- ‚úÖ T·∫•t c·∫£ requests (HTML, CSS, JS, Images, API) ƒë·ªÅu d√πng HTTPS

---

## 6. Auto-Renewal Configuration

### 6.1. Certbot Auto-Renewal
Certbot ƒë√£ t·ª± ƒë·ªông c·∫•u h√¨nh renewal job:
```bash
# Ki·ªÉm tra cron job
cat /etc/crontab | grep certbot
```

Expected output:
```
0 0,12 * * * root python3 -c 'import random; import time; time.sleep(random.random() * 3600)' && certbot renew -q
```

### 6.2. Test Renewal (Dry-run)
```bash
certbot renew --dry-run
```

### 6.3. Force Renewal (n·∫øu c·∫ßn)
```bash
certbot renew --force-renewal
systemctl reload apache2
```

---

## 7. Troubleshooting

### 7.1. L·ªói: DNS problem: NXDOMAIN
**Nguy√™n nh√¢n:** DNS ch∆∞a lan truy·ªÅn ho·∫∑c ch∆∞a c·∫•u h√¨nh ƒë√∫ng
**Gi·∫£i ph√°p:**
1. Ki·ªÉm tra DNS records t·∫°i Tenten.vn
2. ƒê·ª£i 15-30 ph√∫t cho DNS propagation
3. Test b·∫±ng `ping zolachat.site`

### 7.2. L·ªói: Mixed Content Warning
**Nguy√™n nh√¢n:** Backend API tr·∫£ v·ªÅ HTTP URLs thay v√¨ HTTPS
**Gi·∫£i ph√°p:**
```bash
# Ki·ªÉm tra backend config
ssh root@163.61.182.20
systemctl status sticker-upload-api

# Edit backend config ƒë·ªÉ d√πng HTTPS URLs
# File th∆∞·ªùng l√†: /var/www/api/server.js ho·∫∑c app.js
```

### 7.3. L·ªói: Certificate kh√¥ng ƒë∆∞·ª£c browser tin c·∫≠y
**Nguy√™n nh√¢n:** Certbot kh√¥ng install ƒë√∫ng ho·∫∑c certificate b·ªã l·ªói
**Gi·∫£i ph√°p:**
```bash
# Re-run certbot
certbot --apache -d zolachat.site -d www.zolachat.site --force-renewal
```

### 7.4. L·ªói: Redirects too many times
**Nguy√™n nh√¢n:** Loop gi·ªØa HTTP v√† HTTPS redirect
**Gi·∫£i ph√°p:**
```bash
# Disable redirect t·∫°m th·ªùi
a2dissite zolachat.site-le-ssl
systemctl reload apache2

# Re-enable
systemctl reload apache2
```

### 7.5. L·ªói: 503 Service Unavailable (Upload Failed)
**Nguy√™n nh√¢n:** Apache Proxy c·∫•u h√¨nh sai c·ªïng backend (m·∫∑c ƒë·ªãnh 3000, nh∆∞ng service ch·∫°y port 3001/5000).
**Gi·∫£i ph√°p:**
S·ª≠a file `/etc/apache2/sites-available/zolachat.site-le-ssl.conf`:
```apache
# Proxy API requests to backend services
ProxyPreserveHost On

# Sticker Service (Port 3001)
ProxyPass /api/stickers http://localhost:3001/api/stickers
ProxyPassReverse /api/stickers http://localhost:3001/api/stickers

# AI Background Removal Service (Port 5000)
ProxyPass /api/rembg http://localhost:5000/api/rembg
ProxyPassReverse /api/rembg http://localhost:5000/api/rembg
```

### 7.6. L·ªói: ·∫¢nh Sticker kh√¥ng hi·ªÉn th·ªã (Broken Image / 404)
**Nguy√™n nh√¢n:** Web server tr·ªè v√†o `/var/www/admin` nh∆∞ng ·∫£nh n·∫±m ·ªü `/var/www/stickers`.
**Gi·∫£i ph√°p:**
Th√™m Alias v√†o file c·∫•u h√¨nh SSL (`zolachat.site-le-ssl.conf`):
```apache
# Map Image URLs to Sticker Directory
Alias /user /var/www/stickers/user
Alias /thumbnails /var/www/stickers/thumbnails

<Directory "/var/www/stickers">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
    # Enable CORS for images
    Header set Access-Control-Allow-Origin "*"
    # Cache images
    <FilesMatch "\.(webp|png|jpg|gif)$">
        Header set Cache-Control "max-age=2592000, public"
    </FilesMatch>
</Directory>
```
Sau ƒë√≥ reload Apache: `systemctl reload apache2`

---

## 8. Security Best Practices

### 8.1. Force HTTPS Redirect
ƒê√£ ƒë∆∞·ª£c Certbot t·ª± ƒë·ªông c·∫•u h√¨nh trong VirtualHost.

### 8.2. HSTS Headers (Recommended)
Edit `/etc/apache2/sites-available/zolachat.site-le-ssl.conf`:
```apache
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
```

### 8.3. Security Headers
```apache
Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"
```

Sau khi th√™m, reload Apache:
```bash
a2enmod headers
systemctl reload apache2
```

### 8.4. Update Firewall
```bash
# Allow HTTPS
ufw allow 443/tcp

# Optional: Disable HTTP if forcing HTTPS only
# ufw deny 80/tcp
```

---

## 9. Monitoring & Maintenance

### 9.1. Check Certificate Expiry
```bash
# View certificate details
certbot certificates

# Expected: Valid until 2026-03-24
```

### 9.2. Monitor Apache Logs
```bash
# Access log
tail -f /var/log/apache2/zolachat.site_access.log

# Error log
tail -f /var/log/apache2/zolachat.site_error.log
```

### 9.3. Monitor Certbot Renewal Logs
```bash
cat /var/log/letsencrypt/letsencrypt.log
```

---

## 10. URLs & Access Points

### Production URLs (HTTPS)
- **Admin Dashboard:** https://zolachat.site/admin/dashboard.html
- **Sticker Management:** https://zolachat.site/admin/stickers.html
- **User Management:** https://zolachat.site/admin/users.html
- **API Endpoint:** https://zolachat.site/api/stickers/upload

### Legacy URLs (HTTP - Auto redirect to HTTPS)
- http://163.61.182.20/admin/ ‚Üí https://zolachat.site/admin/
- http://zolachat.site/admin/ ‚Üí https://zolachat.site/admin/

### SSH Access
```bash
ssh root@163.61.182.20
# Ho·∫∑c
ssh root@zolachat.site
```

---

## 11. Changelog

**2025-12-24:**
- ‚úÖ Registered domain: zolachat.site
- ‚úÖ Configured DNS A records
- ‚úÖ Installed SSL certificate via Let's Encrypt
- ‚úÖ Updated all scripts and configs to use HTTPS domain
- ‚úÖ Deployed Admin Web with new domain
- ‚úÖ Enabled auto-renewal for SSL certificate

**Certificate Details:**
- Issuer: Let's Encrypt
- Valid from: 2025-12-23
- Expires: 2026-03-24
- Auto-renewal: Enabled (twice daily check)

---

## 12. References

- Let's Encrypt Documentation: https://letsencrypt.org/docs/
- Certbot Apache Guide: https://certbot.eff.org/instructions?ws=apache&os=ubuntufocal
- Apache SSL/TLS: https://httpd.apache.org/docs/2.4/ssl/
- DNS Propagation Checker: https://www.whatsmydns.net/

---

**Document Version:** 1.0
**Last Updated:** 2025-12-24
**Maintainer:** Admin Team
