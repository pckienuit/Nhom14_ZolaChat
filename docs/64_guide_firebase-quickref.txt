# Firebase Quick Reference

## üî• AuthRepository API

### Login
```java
authRepository.login(email, password, new AuthRepository.AuthCallback() {
    @Override
    public void onSuccess(FirebaseUser user) {
        // Login th√†nh c√¥ng
        String userId = user.getUid();
        String email = user.getEmail();
    }
    
    @Override
    public void onError(String error) {
        // Login th·∫•t b·∫°i
        Toast.makeText(context, error, Toast.LENGTH_SHORT).show();
    }
});
```

### Register
```java
authRepository.register(name, email, password, new AuthRepository.AuthCallback() {
    @Override
    public void onSuccess(FirebaseUser user) {
        // Register + Firestore save th√†nh c√¥ng
    }
    
    @Override
    public void onError(String error) {
        // Register th·∫•t b·∫°i
    }
});
```

### Logout
```java
authRepository.logout(); // T·ª± ƒë·ªông update isOnline = false
```

### Check Auth Status
```java
if (authRepository.isAuthenticated()) {
    // User ƒë√£ ƒëƒÉng nh·∫≠p
    FirebaseUser user = authRepository.getCurrentUser();
}
```

## üìä Firestore Schema

### Users Collection
```
users/{userId}
  - userId: string
  - name: string
  - email: string
  - createdAt: timestamp
  - isOnline: boolean
  - lastSeen: timestamp
```

### Read User Data
```java
FirebaseFirestore db = FirebaseFirestore.getInstance();
db.collection("users").document(userId)
    .get()
    .addOnSuccessListener(documentSnapshot -> {
        String name = documentSnapshot.getString("name");
        Boolean isOnline = documentSnapshot.getBoolean("isOnline");
    });
```

### Update User
```java
Map<String, Object> updates = new HashMap<>();
updates.put("isOnline", true);

db.collection("users").document(userId)
    .update(updates)
    .addOnSuccessListener(aVoid -> { /* success */ });
```

## üéØ Usage Examples

### Auto-Login Flow
```java
// LoginActivity.onCreate()
authRepository = new AuthRepository();
if (authRepository.isAuthenticated()) {
    navigateToMain();
    return;
}
```

### Loading State Pattern
```java
private void showLoading(boolean isLoading) {
    progressBar.setVisibility(isLoading ? View.VISIBLE : View.GONE);
    button.setEnabled(!isLoading);
    editText.setEnabled(!isLoading);
}
```

### Navigation v·ªõi Clear Stack
```java
Intent intent = new Intent(this, LoginActivity.class);
intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
startActivity(intent);
finish();
```

## ‚ö†Ô∏è Error Codes

```java
// Common Firebase Auth errors
ERROR_INVALID_EMAIL
ERROR_WRONG_PASSWORD
ERROR_USER_NOT_FOUND
ERROR_EMAIL_ALREADY_IN_USE
ERROR_WEAK_PASSWORD
ERROR_NETWORK_REQUEST_FAILED
```

## üîß Build Commands

```bash
# Windows
.\gradlew clean
.\gradlew build
.\gradlew installDebug

# Check for errors
.\gradlew compileDebugJavaWithJavac
```

## üß™ Test Credentials

```
Email: test@example.com
Password: 123456

Ho·∫∑c t·∫°o account m·ªõi qua Sign Up screen
```
